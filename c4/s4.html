

<!DOCTYPE html>


<html lang="zh-CN" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>4.4 通用转发与 SDN &#8212; 计算机网络: 自顶向下</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystyles.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/tabs.js"></script>
    <script>let toggleHintShow = '原文';</script>
    <script>let toggleHintHide = '收起';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script src="../_static/translations.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'c4/s4';</script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="4.5 小结" href="summary.html" />
    <link rel="prev" title="4.3 Internet 协议（IP）：IPv4、地址、IPv6 等" href="s3.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="zh-CN"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">计算机网络: 自顶向下</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="搜索" aria-label="搜索" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">搜索</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">内容</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../about_author.html">关于作者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preface.html">前言</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../c1/index.html">第 1 章 计算机网络与因特网</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../c1/s1.html">1.1 什么是互联网？</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c1/s2.html">1.2 网络边缘</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c1/s3.html">1.3 网络核心</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c1/s4.html">1.4 分组交换网络中的时延、丢包与吞吐量</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c1/s5.html">1.5 协议层与其服务模型</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c1/s6.html">1.6 网络攻击</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c1/s7.html">1.7 计算机网络与互联网的发展历史</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c1/summary.html">1.8 小结</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c1/homework.html">家庭作业问题和疑问</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c1/wiresharklab.html">Wireshark 实验室</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c1/interview.html">访谈：Leonard Kleinrock</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../c2/index.html">第 2 章 应用层</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../c2/s1.html">2.1 网络应用程序原理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c2/s2.html">2.2 Web 与 HTTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c2/s3.html">2.3 互联网中的电子邮件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c2/s4.html">2.4 DNS——互联网的目录服务</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c2/s5.html">2.5 对等网络应用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c2/s6.html">2.6 视频流与内容分发</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c2/s7.html">2.7 套接字编程：创建网络应用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c2/summary.html">2.9 小结</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c2/homework.html">家庭作业问题和疑问</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c2/socketpro.html">Socket 编程作业</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c2/wiresharklab.html">Wireshark 实验室</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c2/interview.html">访谈: Marc Andreessen</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../c3/index.html">第 3 章 传输层</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../c3/s1.html">3.1 引言与传输层服务</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3/s2.html">3.2 复用与解复用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3/s3.html">3.3 无连接传输：UDP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3/s4.html">3.4 可靠数据传输的原理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3/s5.html">3.5 面向连接的传输：TCP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3/s6.html">3.6 拥塞控制原理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3/s7.html">3.7 TCP 拥塞控制</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3/summary.html">3.8 小结</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3/homework.html">家庭作业问题和疑问</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3/wiresharklab.html">Wireshark 实验室</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c3/interview.html">访谈: Van Jacobson</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">第 4 章 网络层：数据平面</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="s1.html">4.1 网络层概述</a></li>
<li class="toctree-l2"><a class="reference internal" href="s2.html">4.2 路由器的内部结构</a></li>
<li class="toctree-l2"><a class="reference internal" href="s3.html">4.3 Internet 协议（IP）：IPv4、地址、IPv6 等</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">4.4 通用转发与 SDN</a></li>
<li class="toctree-l2"><a class="reference internal" href="summary.html">4.5 小结</a></li>
<li class="toctree-l2"><a class="reference internal" href="homework.html">家庭作业问题和疑问</a></li>
<li class="toctree-l2"><a class="reference internal" href="wiresharklab.html">Wireshark 实验室</a></li>
<li class="toctree-l2"><a class="reference internal" href="interview.html">访谈: Vinton G. Cerf</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../c5/index.html">第 5 章 网络层：控制平面</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../c5/s1.html">5.1 引言</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c5/s2.html">5.2 路由算法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c5/s3.html">5.3 互联网中的域内路由：OSPF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c5/s4.html">5.4 ISP 之间的路由：BGP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c5/s5.html">5.5 SDN 控制平面</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c5/s6.html">5.6 ICMP：因特网控制报文协议</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c5/s7.html">5.7 网络管理与 SNMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c5/summary.html">5.8 小结</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c5/homework.html">家庭作业问题和疑问</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c5/wiresharklab.html">Wireshark 实验室</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c5/interview.html">访谈: Jennifer Rexford</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../c6/index.html">第 6 章 链路层与局域网（LANs）</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../c6/s1.html">6.1 链路层简介</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c6/s2.html">6.2 错误检测与纠正技术</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c6/s3.html">6.3 多路访问链路与协议</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c6/s4.html">6.4 交换式局域网</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c6/s5.html">6.5 链路虚拟化：作为链路层的网络</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c6/s6.html">6.6 数据中心网络</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c6/s7.html">6.7 回顾：网页请求生命周期中的一天</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c6/summary.html">6.8 小结</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c6/homework.html">家庭作业问题和疑问</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c6/wiresharklab.html">Wireshark 实验室</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c6/interview.html">访谈：Simon S. Lam</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../c7/index.html">第 7 章 无线与移动网络</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../c7/s1.html">7.1 简介</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c7/s2.html">7.2 无线链接和网络特性</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c7/s3.html">7.3 WiFi：802.11 无线局域网</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c7/s4.html">7.4 蜂窝互联网接入</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c7/s5.html">7.5 移动性管理：原理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c7/s6.html">7.6 移动 IP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c7/s7.html">7.7 蜂窝网络中的移动性管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c7/s8.html">7.8 无线与移动性：对高层协议的影响</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c7/summary.html">7.9 小结</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c7/homework.html">家庭作业问题和疑问</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c7/wiresharklab.html">Wireshark 实验室</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c7/interview.html">访谈: Deborah Estrin</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../c8/index.html">第 8 章 计算机网络中的安全</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../c8/s1.html">8.1 什么是网络安全？</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c8/s2.html">8.2 密码学原理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c8/s3.html">8.3 消息完整性和数字签名</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c8/s4.html">8.4 终端认证</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c8/s5.html">8.5 电子邮件安全</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c8/s6.html">8.6 保护 TCP 连接: SSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c8/s7.html">8.7 网络层安全: IPsec 和虚拟专用网络</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c8/s8.html">8.8 无线局域网的安全</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c8/s9.html">8.9 运行安全：防火墙和入侵检测系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c8/summary.html">8.10 小结</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c8/homework.html">课后习题与问题</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c8/wiresharklab.html">Wireshark 实验室</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c8/interview.html">访谈：Steven M. Bellovin</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../c9/index.html">第 9 章 多媒体网络</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../c9/s1.html">9.1 多媒体网络应用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c9/s2.html">9.2 流媒体存储视频</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c9/s3.html">9.3 基于 IP 的语音通信</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c9/s4.html">9.4 实时对话应用的协议</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c9/s5.html">9.5 多媒体的网络支持</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c9/summary.html">9.6 小结</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c9/homework.html">家庭作业问题和疑问</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c9/interview.html">访谈：Henning Schulzrinne</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">引用</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/hellowac/computer-net-zh-cn" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="源码库"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="下载此页面">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/c4/s4.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="下载源文件"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="列印成 PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="全屏模式"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="搜索" aria-label="搜索" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>4.4 通用转发与 SDN</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> 目录 </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#match">4.4.1 Match</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#action">4.4.2 Action</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#openflow-match-plus-action">4.4.3 OpenFlow 中 Match-plus-action 的实际示例</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">第一个示例：简单转发</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">第二个示例：负载均衡</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">第三个示例：防火墙</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="sdn">
<span id="c4-4"></span><h1>4.4 通用转发与 SDN<a class="headerlink" href="#sdn" title="此标题的永久链接">#</a></h1>
<p>4.4 Generalized Forwarding and SDN</p>
<p>在 <a class="reference internal" href="s2.html#c4-2-1"><span class="std std-ref">Section 4.2.1</span></a> 中，我们指出，互联网路由器的转发决策传统上仅基于分组的目的地址。然而在上一节中，我们也看到中间盒数量的激增，这些中间盒执行许多第三层功能。NAT 盒会重写报头中的 IP 地址和端口号；防火墙根据报头字段的值阻止流量或将分组重定向以进行附加处理，如深度包检测（DPI）。负载均衡器将请求某项服务（例如 HTTP 请求）的分组转发到提供该服务的一组服务器中的某一个。<a class="reference internal" href="../references.html#rfc-3234"><span class="std std-ref">[RFC 3234]</span></a> 列举了一些常见的中间盒功能。</p>
<p>这种中间盒、第二层交换机和第三层路由器的激增 <a class="reference internal" href="../references.html#qazi-2013"><span class="std std-ref">[Qazi 2013]</span></a>——每种都有其专用的硬件、软件和管理接口——无疑给许多网络运营商带来了昂贵的困扰。然而，近年来软件定义网络（SDN）的进展已经承诺，并正在实现一种统一的方法，以现代、优雅且集成的方式提供这些网络层功能，以及某些链路层功能。</p>
<p>回想一下 <span class="xref std std-ref">[Section 4.2.1]</span> 中将基于目的地的转发描述为两个步骤：查找目的 IP 地址（“匹配”），然后将分组送入交换结构以到达指定的输出端口（“动作”）。现在我们来考虑一种更通用的“匹配+动作”范式，其中“匹配”可以基于协议栈中不同层的多个报头字段进行。“动作”可以包括将分组转发到一个或多个输出端口（如基于目的的转发）、将分组在多个通往服务的出口接口之间进行负载均衡（如负载均衡）、重写报头值（如 NAT）、故意阻止/丢弃分组（如防火墙）、将分组发送到特殊服务器以进一步处理（如 DPI）等。</p>
<p>在通用转发中，匹配+动作表是我们在 <span class="xref std std-ref">[Section 4.2.1]</span> 中遇到的基于目的地的转发表的推广。由于转发决策可能基于网络层和/或链路层的源和目的地址，<a class="reference internal" href="#figure-4-28"><span class="std std-ref">Figure 4.28</span></a> 中所示的转发设备更准确地被称为“分组交换机”，而不是第三层“路由器”或第二层“交换机”。因此，在本节的其余部分以及 <a class="reference internal" href="../c5/s5.html#c5-5"><span class="std std-ref">Section 5.5</span></a> 中，我们将这些设备称为分组交换机，采用 SDN 文献中被广泛采纳的术语。</p>
<figure class="align-center" id="figure-4-28">
<img alt="../_images/403-0.png" src="../_images/403-0.png" />
</figure>
<p><strong>图 4.28 通用转发：每个分组交换机包含一个由远程控制器计算并分发的匹配+动作表</strong></p>
<p><a class="reference internal" href="#figure-4-28"><span class="std std-ref">Figure 4.28</span></a> 展示了每个分组交换机中的匹配+动作表，该表由远程控制器计算、安装并更新。我们注意到，虽然每个分组交换机中的控制组件可以彼此交互（例如方式类似于 <a class="reference internal" href="s1.html#figure-4-2"><span class="std std-ref">Figure 4.2</span></a>），但在实践中，通用的匹配+动作能力是通过一个远程控制器实现的，该控制器计算、安装并更新这些表。你可以花些时间比较 <a class="reference internal" href="s1.html#figure-4-2"><span class="std std-ref">Figures 4.2</span></a>、<a class="reference internal" href="s1.html#figure-4-3"><span class="std std-ref">4.3</span></a> 和 <a class="reference internal" href="#figure-4-28"><span class="std std-ref">4.28</span></a>——你能注意到 <a class="reference internal" href="s1.html#figure-4-2"><span class="std std-ref">Figure 4.2</span></a> 和 <a class="reference internal" href="s1.html#figure-4-3"><span class="std std-ref">4.3</span></a> 所示的基于目的的转发与 <a class="reference internal" href="#figure-4-28"><span class="std std-ref">Figure 4.28</span></a> 所示的通用转发之间有哪些相似点和不同点？</p>
<p>我们接下来的通用转发讨论将基于 OpenFlow [<a class="reference internal" href="../references.html#mckeown-2008"><span class="std std-ref">McKeown 2008</span></a>，<a class="reference internal" href="../references.html#openflow-2009"><span class="std std-ref">OpenFlow 2009</span></a>，<a class="reference internal" href="../references.html#casado-2014"><span class="std std-ref">Casado 2014</span></a>，<a class="reference internal" href="../references.html#tourrilhes-2014"><span class="std std-ref">Tourrilhes 2014</span></a>]——这是一个广为人知且成功的标准，它开创了匹配+动作转发抽象与控制器的概念，并推动了 SDN 革命的更广泛发展 <a class="reference internal" href="../references.html#feamster-2013"><span class="std std-ref">[Feamster 2013]</span></a>。我们主要考虑 OpenFlow 1.0，该版本以特别清晰简洁的方式引入了关键的 SDN 抽象与功能。后续的 OpenFlow 版本根据实现和使用经验引入了附加功能；当前与早期的 OpenFlow 标准版本可在 <a class="reference internal" href="../references.html#onf-2016"><span class="std std-ref">[ONF 2016]</span></a> 中找到。</p>
<p>每个 <strong>匹配+动作</strong> 转发表项，在 OpenFlow 中称为 <strong>流表</strong>，包括：</p>
<ul class="simple">
<li><p>一组 <em>报头字段值</em>，用于与到达分组进行匹配。如同基于目的地转发一样，基于硬件的匹配最快可在 TCAM 内存中完成，可容纳超过一百万个目的地址项 <a class="reference internal" href="../references.html#bosshart-2013"><span class="std std-ref">[Bosshart 2013]</span></a>。如果分组不匹配任何流表项，则可以被丢弃或发送到远程控制器进行进一步处理。在实践中，出于性能或成本原因，一个流表可以由多个流表实现 <a class="reference internal" href="../references.html#bosshart-2013"><span class="std std-ref">[Bosshart 2013]</span></a>，但在这里我们聚焦于单一流表的抽象。</p></li>
<li><p>一组计数器，用于在分组匹配流表项时更新。这些计数器可能包括与该表项匹配的分组数，及该表项最后一次更新以来的时间。</p></li>
<li><p>一组当分组匹配某流表项时要执行的动作。这些动作可能包括将分组转发到指定输出端口、丢弃分组、复制分组并发送至多个输出端口、重写选定的报头字段等。</p></li>
</ul>
<p>我们将在 <a class="reference internal" href="#c4-4-1"><span class="std std-ref">Sections 4.4.1</span></a> 和 <a class="reference internal" href="#c4-4-2"><span class="std std-ref">4.4.2</span></a> 中进一步探讨匹配和动作。在 <a class="reference internal" href="#c4-4-3"><span class="std std-ref">Section 4.4.3</span></a> 中，我们将学习如何利用分组交换机中每个匹配规则的网络范围集合来实现多种功能，包括路由、第二层交换、防火墙、负载均衡、虚拟网络等。最后我们指出，流表本质上是一个 API，是编程单个分组交换机行为的抽象；在 <a class="reference internal" href="#c4-4-3"><span class="std std-ref">Section 4.4.3</span></a> 中我们将看到，网络范围的行为也可以通过适当编程/配置这些网络分组交换机的流表来实现 <a class="reference internal" href="../references.html#casado-2014"><span class="std std-ref">[Casado 2014]</span></a>。</p>
<div class="toggle docutils container">
<p>In <a class="reference internal" href="s2.html#c4-2-1"><span class="std std-ref">Section 4.2.1</span></a>, we noted that an Internet router’s forwarding decision has traditionally been based solely on a packet’s destination address. In the previous section, however, we’ve also seen that there has been a proliferation of middleboxes that perform many layer-3 functions. NAT boxes rewrite header IP addresses and port numbers; firewalls block traffic based on header-field values or redirect packets for additional processing, such as deep packet inspection (DPI). Load-balancers forward packets requesting a given service (e.g., an HTTP request) to one of a set of a set of servers that provide that service. <a class="reference internal" href="../references.html#rfc-3234"><span class="std std-ref">[RFC 3234]</span></a> lists a number of common middlebox functions.</p>
<p>This proliferation of middleboxes, layer-2 switches, and layer-3 routers <a class="reference internal" href="../references.html#qazi-2013"><span class="std std-ref">[Qazi 2013]</span></a>—each with its own specialized hardware, software and management interfaces—has undoubtedly resulted in costly headaches for many network operators. However, recent advances in software-defined networking have promised, and are now delivering, a unified approach towards providing many of these network-layer functions, and certain link-layer functions as well, in a modern, elegant, and integrated manner.</p>
<p>Recall that <span class="xref std std-ref">[Section 4.2.1]</span> characterized destination-based forwarding as the two steps of looking up a destination IP address (“match”), then sending the packet into the switching fabric to the specified output port (“action”). Let’s now consider a significantly more general “match-plus-action” paradigm, where the “match” can be made over multiple header fields associated with different protocols at different layers in the protocol stack. The “action” can include forwarding the packet to one or more output ports (as in destination-based forwarding), load balancing packets across multiple outgoing interfaces that lead to a service (as in load balancing), rewriting header values (as in NAT), purposefully blocking/dropping a packet (as in a firewall), sending a packet to a special server for further processing and action (as in DPI), and more.</p>
<p>In generalized forwarding, a match-plus-action table generalizes the notion of the destination-based forwarding table that we encountered in <span class="xref std std-ref">[Section 4.2.1]</span>. Because forwarding decisions may be made using network-layer and/or link-layer source and destination addresses, the forwarding devices shown in <a class="reference internal" href="#figure-4-28"><span class="std std-ref">Figure 4.28</span></a> are more accurately described as “packet switches” rather than layer 3 “routers” or layer 2 “switches.” Thus, in the remainder of this section, and in <a class="reference internal" href="../c5/s5.html#c5-5"><span class="std std-ref">Section 5.5</span></a>, we’ll refer to these devices as packet switches, adopting the terminology that is gaining widespread adoption in SDN literature.</p>
<figure class="align-center">
<img alt="../_images/403-0.png" src="../_images/403-0.png" />
</figure>
<p><strong>Figure 4.28 Generalized forwarding: Each packet switch contains a match-plus-action table that is computed and distributed by a remote controller</strong></p>
<p><a class="reference internal" href="#figure-4-28"><span class="std std-ref">Figure 4.28</span></a> shows a match-plus-action table in each packet switch, with the table being computed, installed, and updated by a remote controller. We note that while it is possible for the control components at the individual packet switch to interact with each other (e.g., in a manner similar to that in <a class="reference internal" href="s1.html#figure-4-2"><span class="std std-ref">Figure 4.2</span></a>), in practice generalized match-plus-action capabilities are implemented via a remote controller that computes, installs, and updates these tables. You might take a minute to compare <a class="reference internal" href="s1.html#figure-4-2"><span class="std std-ref">Figures 4.2</span></a>, <a class="reference internal" href="s1.html#figure-4-3"><span class="std std-ref">4.3</span></a> and <a class="reference internal" href="#figure-4-28"><span class="std std-ref">4.3</span></a>—what similarities and differences do you notice between destination-based forwarding shown in <a class="reference internal" href="s1.html#figure-4-2"><span class="std std-ref">Figure 4.2</span></a> and <a class="reference internal" href="s1.html#figure-4-3"><span class="std std-ref">4.3</span></a>, and generalized forwarding shown in <a class="reference internal" href="#figure-4-28"><span class="std std-ref">Figure 4.28</span></a>?</p>
<p>Our following discussion of generalized forwarding will be based on OpenFlow [<a class="reference internal" href="../references.html#mckeown-2008"><span class="std std-ref">McKeown 2008</span></a>, <a class="reference internal" href="../references.html#openflow-2009"><span class="std std-ref">OpenFlow 2009</span></a>, <a class="reference internal" href="../references.html#casado-2014"><span class="std std-ref">Casado 2014</span></a>, <a class="reference internal" href="../references.html#tourrilhes-2014"><span class="std std-ref">Tourrilhes 2014</span></a>]—a highly visible and successful standard that has pioneered the notion of the match-plus-action forwarding abstraction and controllers, as well as the SDN revolution more generally <a class="reference internal" href="../references.html#feamster-2013"><span class="std std-ref">[Feamster 2013]</span></a>. We’ll primarily consider OpenFlow 1.0, which introduced key SDN abstractions and functionality in a particularly clear and concise manner. Later versions of OpenFlow introduced additional capabilities as a result of experience gained through implementation and use; current and earlier versions of the OpenFlow standard can be found at <a class="reference internal" href="../references.html#onf-2016"><span class="std std-ref">[ONF 2016]</span></a>.</p>
<p>Each entry in the match-plus-action forwarding table, known as a <strong>flow table</strong> in OpenFlow, includes:</p>
<ul class="simple">
<li><p>A set of <em>header field values</em> to which an incoming packet will be matched. As in the case of destination-based forwarding, hardware-based matching is most rapidly performed in TCAM memory, with more than a million destination address entries being possible <a class="reference internal" href="../references.html#bosshart-2013"><span class="std std-ref">[Bosshart 2013]</span></a>. A packet that matches no flow table entry can be dropped or sent to the remote controller for more processing. In practice, a flow table may be implemented by multiple flow tables for performance or cost reasons <a class="reference internal" href="../references.html#bosshart-2013"><span class="std std-ref">[Bosshart 2013]</span></a>, but we’ll focus here on the abstraction of a single flow table.</p></li>
<li><p>A set of counters that are updated as packets are matched to flow table entries. These counters might include the number of packets that have been matched by that table entry, and the time since the table entry was last updated.</p></li>
<li><p>A set of actions to be taken when a packet matches a flow table entry. These actions might be to forward the packet to a given output port, to drop the packet, makes copies of the packet and sent them to multiple output ports, and/or to rewrite selected header fields.</p></li>
</ul>
<p>We’ll explore matching and actions in more detail in <a class="reference internal" href="#c4-4-1"><span class="std std-ref">Sections 4.4.1</span></a> and <a class="reference internal" href="#c4-4-2"><span class="std std-ref">4.4.2</span></a>, respectively. We’ll then study how the network-wide collection of per-packet switch matching rules can be used to implement a wide range of functions including routing, layer-2 switching, firewalling, load-balancing, virtual networks, and more in <a class="reference internal" href="#c4-4-3"><span class="std std-ref">Section 4.4.3</span></a>. In closing, we note that the flow table is essentially an API, the abstraction through which an individual packet switch’s behavior can be programmed; we’ll see in <a class="reference internal" href="#c4-4-3"><span class="std std-ref">Section 4.4.3</span></a> that network-wide behaviors can similarly be programmed by appropriately programming/configuring these tables in a collection of network packet switches <a class="reference internal" href="../references.html#casado-2014"><span class="std std-ref">[Casado 2014]</span></a>.</p>
</div>
<section id="match">
<span id="c4-4-1"></span><h2>4.4.1 Match<a class="headerlink" href="#match" title="此标题的永久链接">#</a></h2>
<p><a class="reference internal" href="#figure-4-29"><span class="std std-ref">图 4.29</span></a> 展示了 OpenFlow 1.0 中 match-plus-action 规则可匹配的十一种分组首部字段以及入端口 ID。回顾 <a class="reference internal" href="../c1/s5.html#c1-5-2"><span class="std std-ref">第 1.5.2 节</span></a>，我们提到一个链路层（第 2 层）帧到达一个分组交换机时，其有效载荷是一个网络层（第 3 层）数据报，而该数据报通常又包含一个传输层（第 4 层）段。我们首先观察到，OpenFlow 的匹配抽象允许在三个协议层的部分首部字段上进行匹配（从而相当公然地违背了我们在 <a class="reference internal" href="../c1/s5.html#c1-5"><span class="std std-ref">第 1.5 节</span></a> 中学习的分层原则）。由于我们尚未涉及链路层，在此仅需知道，<a class="reference internal" href="#figure-4-29"><span class="std std-ref">图 4.29</span></a> 中显示的源和目标 MAC 地址是与该帧的发送和接收接口相关联的链路层地址；通过基于以太网地址而非 IP 地址进行转发，我们可以看到，一个支持 OpenFlow 的设备既可以作为路由器（第 3 层设备）转发数据报，也可以作为交换机（第 2 层设备）转发帧。以太网类型字段对应于该帧的有效载荷将被解复用到的上层协议（如 IP），而 VLAN 字段涉及所谓的虚拟局域网，我们将在 <a class="reference internal" href="../c6/index.html#c6"><span class="std std-ref">第 6 章</span></a> 中学习。OpenFlow 1.0 规范中可匹配的十二个字段值在更近的 OpenFlow 规范中已扩展为 41 个字段值 <span class="xref std std-ref">[Bosshart 2014]</span>。</p>
<figure class="align-center" id="figure-4-29">
<img alt="../_images/404-0.png" src="../_images/404-0.png" />
</figure>
<p><strong>图 4.29 OpenFlow 1.0 流表中的分组匹配字段</strong></p>
<p>入端口是指分组在分组交换机上接收时的输入端口。分组的 IP 源地址、IP 目标地址、IP 协议字段和 IP 服务类型字段在前面的 <a class="reference internal" href="s3.html#c4-3-1"><span class="std std-ref">第 4.3.1 节</span></a> 中已讨论过。传输层的源端口号和目标端口号字段也可以用于匹配。</p>
<p>流表项还可以包含通配符。例如，流表中 IP 地址为 128.119.*.* 的项将匹配所有具有以 128.119 为前 16 位地址的对应数据报地址字段。每个流表项也有一个关联的优先级。如果一个分组匹配多个流表项，将选择优先级最高的匹配项及其对应的动作。</p>
<p>最后，我们注意到并非 IP 首部中的所有字段都可用于匹配。例如，OpenFlow 不允许基于 TTL 字段或数据报长度字段进行匹配。为什么某些字段可以用于匹配，而另一些则不可以？答案无疑涉及功能性与复杂性之间的权衡。在选择抽象的“艺术”中，关键在于提供足够的功能来完成任务（在本例中是实现、配置和管理广泛的网络层功能，这些功能此前通过各类网络层设备实现），同时又不因过度细节和泛化使抽象变得臃肿且难以使用。Butler Lampson 曾著名地指出 <a class="reference internal" href="../references.html#lampson-1983"><span class="std std-ref">[Lampson 1983]</span></a>：</p>
<blockquote>
<div><p><em>一次只做一件事，并把它做好。一个接口应捕捉抽象的最小要素。不要泛化；泛化通常是错误的。</em></p>
</div></blockquote>
<p>考虑到 OpenFlow 的成功，我们可以推测其设计者确实很好地选择了他们的抽象。有关 OpenFlow 匹配的更多细节可参见 [<a class="reference internal" href="../references.html#openflow-2009"><span class="std std-ref">OpenFlow 2009</span></a>，<a class="reference internal" href="../references.html#onf-2016"><span class="std std-ref">ONF 2016</span></a>]。</p>
<div class="toggle docutils container">
<p><a class="reference internal" href="#figure-4-29"><span class="std std-ref">Figure 4.29</span></a> shows the eleven packet-header fields and the incoming port ID that can be matched in an OpenFlow 1.0 match-plus-action rule. Recall from <a class="reference internal" href="../c1/s5.html#c1-5-2"><span class="std std-ref">Section 1.5.2</span></a> that a link-layer (layer 2) frame arriving to a packet switch will contain a network-layer (layer 3) datagram as its payload, which in turn will typically contain a transport-layer (layer 4) segment. The first observation we make is that OpenFlow’s match abstraction allows for a match to be made on selected fields from three layers of protocol headers (thus rather brazenly defying the layering principle we studied in <a class="reference internal" href="../c1/s5.html#c1-5"><span class="std std-ref">Section 1.5</span></a>). Since we’ve not yet covered the link layer, suffice it to say that the source and destination MAC addresses shown in <a class="reference internal" href="#figure-4-29"><span class="std std-ref">Figure 4.29</span></a> are the link-layer addresses associated with the frame’s sending and receiving interfaces; by forwarding on the basis of Ethernet addresses rather than IP addresses, we can see that an OpenFlow-enabled device can equally perform as a router (layer-3 device) forwarding datagrams as well as a switch (layer-2 device) forwarding frames. The Ethernet type field corresponds to the upper layer protocol (e.g., IP) to which the frame’s payload will be de- multiplexed, and the VLAN fields are concerned with so-called virtual local area networks that we’ll study in <a class="reference internal" href="../c6/index.html#c6"><span class="std std-ref">Chapter 6</span></a>. The set of twelve values that can be matched in the OpenFlow 1.0 specification has grown to 41 values in more recent OpenFlow specifications <span class="xref std std-ref">[Bosshart 2014]</span>.</p>
<figure class="align-center">
<img alt="../_images/404-0.png" src="../_images/404-0.png" />
</figure>
<p><strong>Figure 4.29 Packet matching fields, OpenFlow 1.0 flow table</strong></p>
<p>The ingress port refers to the input port at the packet switch on which a packet is received. The packet’s IP source address, IP destination address, IP protocol field, and IP type of service fields were discussed earlier in <a class="reference internal" href="s3.html#c4-3-1"><span class="std std-ref">Section 4.3.1</span></a>. The transport-layer source and destination port number fields can also be matched.</p>
<p>Flow table entries may also have wildcards. For example, an IP address of 128.119.*.* in a flow table will match the corresponding address field of any datagram that has 128.119 as the first 16 bits of its address. Each flow table entry also has an associated priority. If a packet matches multiple flow table entries, the selected match and corresponding action will be that of the highest priority entry with which the packet matches.</p>
<p>Lastly, we observe that not all fields in an IP header can be matched. For example OpenFlow does not allow matching on the basis of TTL field or datagram length field. Why are some fields allowed for matching, while others are not? Undoubtedly, the answer has to do with the tradeoff between functionality and complexity. The “art” in choosing an abstraction is to provide for enough functionality to accomplish a task (in this case to implement, configure, and manage a wide range of network-layer functions that had previously been implemented through an assortment of network-layer devices), without over-burdening the abstraction with so much detail and generality that it becomes bloated and unusable. Butler Lampson has famously noted <a class="reference internal" href="../references.html#lampson-1983"><span class="std std-ref">[Lampson 1983]</span></a>:</p>
<blockquote>
<div><p><em>Do one thing at a time, and do it well. An interface should capture the minimum essentials of an abstraction. Don’t generalize; generalizations are generally wrong.</em></p>
</div></blockquote>
<p>Given OpenFlow’s success, one can surmise that its designers indeed chose their abstraction well. Additional details of OpenFlow matching can be found in [<a class="reference internal" href="../references.html#openflow-2009"><span class="std std-ref">OpenFlow 2009</span></a>, <a class="reference internal" href="../references.html#onf-2016"><span class="std std-ref">ONF 2016</span></a>].</p>
</div>
</section>
<section id="action">
<span id="c4-4-2"></span><h2>4.4.2 Action<a class="headerlink" href="#action" title="此标题的永久链接">#</a></h2>
<p>如 <a class="reference internal" href="#figure-4-28"><span class="std std-ref">图 4.28</span></a> 所示，每个流表项都有一个动作列表（可能为空），用于决定对匹配到该流表项的分组所执行的处理。如果有多个动作，它们将按列表中指定的顺序依次执行。</p>
<p>最重要的几个可能动作包括：</p>
<ul class="simple">
<li><p><strong>转发（Forwarding）</strong>。入站分组可以被转发到某个特定的物理输出端口，在所有端口（除了其到达端口）上广播，或者在某个选定的端口集合上多播。该分组也可以被封装并发送至该设备的远程控制器。控制器随后可以（也可能不会）对该分组执行某些操作，包括安装新的流表项，并可将该分组返回至设备以按照更新后的流表规则进行转发。</p></li>
<li><p><strong>丢弃（Dropping）</strong>。一个无动作的流表项表示匹配到的分组应被丢弃。</p></li>
<li><p><strong>字段修改（Modify-field）</strong>。在选择的输出端口转发之前，可以重写十个分组首部字段的值（即 <a class="reference internal" href="#figure-4-29"><span class="std std-ref">图 4.29</span></a> 中所有第 2 层、第 3 层和第 4 层字段，除了 IP 协议字段）。</p></li>
</ul>
<div class="toggle docutils container">
<p>As shown in <a class="reference internal" href="#figure-4-28"><span class="std std-ref">Figure 4.28</span></a>, each flow table entry has a list of zero or more actions that determine the processing that is to be applied to a packet that matches a flow table entry. If there are multiple actions, they are performed in the order specified in the list.</p>
<p>Among the most important possible actions are:</p>
<ul class="simple">
<li><p><strong>Forwarding</strong>. An incoming packet may be forwarded to a particular physical output port, broadcast over all ports (except the port on which it arrived) or multicast over a selected set of ports. The packet may be encapsulated and sent to the remote controller for this device. That controller then may (or may not) take some action on that packet, including installing new flow table entries, and may return the packet to the device for forwarding under the updated set of flow table rules.</p></li>
<li><p><strong>Dropping</strong>. A flow table entry with no action indicates that a matched packet should be dropped.</p></li>
<li><p><strong>Modify-field</strong>. The values in ten packet header fields (all layer 2, 3, and 4 fields shown in <a class="reference internal" href="#figure-4-29"><span class="std std-ref">Figure 4.29</span></a> except the IP Protocol field) may be re-written before the packet is forwarded to the chosen output port.</p></li>
</ul>
</div>
</section>
<section id="openflow-match-plus-action">
<span id="c4-4-3"></span><h2>4.4.3 OpenFlow 中 Match-plus-action 的实际示例<a class="headerlink" href="#openflow-match-plus-action" title="此标题的永久链接">#</a></h2>
<p>4.4.3 OpenFlow Examples of Match-plus-action in Action</p>
<p>在已经考察了通用转发的匹配和动作组成部分之后，我们将把这些概念结合应用到 <a class="reference internal" href="#figure-4-30"><span class="std std-ref">图 4.30</span></a> 所示的示例网络中。该网络包含 6 个主机（h1、h2、h3、h4、h5 和 h6）和三个分组交换机（s1、s2 和 s3），每个交换机有四个本地接口（编号为 1 到 4）。我们将考虑希望实现的一些网络级行为，以及为在 s1、s2 和 s3 中实现这些行为所需的流表项。</p>
<figure class="align-center" id="figure-4-30">
<img alt="../_images/406-0.png" src="../_images/406-0.png" />
</figure>
<p><strong>图 4.30 包含三个分组交换机、6 个主机和一个 OpenFlow 控制器的 match-plus-action 网络</strong></p>
<div class="toggle docutils container">
<p>Having now considered both the match and action components of generalized forwarding, let’s put these ideas together in the context of the sample network shown in <a class="reference internal" href="#figure-4-30"><span class="std std-ref">Figure 4.30</span></a>. The network has 6 hosts (h1, h2, h3, h4, h5 and h6) and three packet switches (s1, s2 and s3), each with four local interfaces (numbered 1 through 4). We’ll consider a number of network-wide behaviors that we’d like to implement, and the flow table entries in s1, s2 and s3 needed to implement this behavior.</p>
<figure class="align-center">
<img alt="../_images/406-0.png" src="../_images/406-0.png" />
</figure>
<p><strong>Figure 4.30 OpenFlow match-plus-action network with three packet switches, 6 hosts, and an OpenFlow controller</strong></p>
</div>
<section id="id1">
<h3>第一个示例：简单转发<a class="headerlink" href="#id1" title="此标题的永久链接">#</a></h3>
<p>A First Example: Simple Forwarding</p>
<p>作为一个非常简单的示例，假设我们期望的转发行为是：来自 h5 或 h6，目的地为 h3 或 h4 的分组应当从 s3 转发至 s1，再由 s1 转发至 s2（完全避开 s3 和 s2 之间的链路）。s1 中的流表项如下：</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>s1 流表（示例 1）</p></th>
</tr>
<tr class="row-even"><th class="head"><p>匹配条件</p></th>
<th class="head"><p>动作</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>入端口 = 1；IP 源地址 = 10.3.*.*；IP 目标地址 = 10.2.*.*</p></td>
<td><p>Forward(4)</p></td>
</tr>
<tr class="row-even"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
</div>
<p>当然，我们还需要在 s3 中配置一个流表项，以便从 h5 或 h6 发送的分组被转发到 s1 的出口接口 3：</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>s3 流表（示例 1）</p></th>
</tr>
<tr class="row-even"><th class="head"><p>匹配条件</p></th>
<th class="head"><p>动作</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>IP 源地址 = 10.3.*.*；IP 目标地址 = 10.2.*.*</p></td>
<td><p>Forward(3)</p></td>
</tr>
<tr class="row-even"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
</div>
<p>最后，为完成该示例，还需要在 s2 中配置一个流表项，使从 s1 到达的分组能够被转发至其目标主机 h3 或 h4：</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>s2 流表（示例 1）</p></th>
</tr>
<tr class="row-even"><th class="head"><p>匹配条件</p></th>
<th class="head"><p>动作</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>入端口 = 2；IP 目标地址 = 10.2.0.3</p></td>
<td><p>Forward(3)</p></td>
</tr>
<tr class="row-even"><td><p>入端口 = 2；IP 目标地址 = 10.2.0.4</p></td>
<td><p>Forward(4)</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
</div>
<div class="toggle docutils container">
<p>As a very simple example, suppose that the desired forwarding behavior is that packets from h5 or h6 destined to h3 or h4 are to be forwarded from s3 to s1, and then from s1 to s2 (thus completely avoiding the use of the link between s3 and s2). The flow table entry in s1 would be:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>s1 Flow Table (Example 1)</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Match</p></th>
<th class="head"><p>Action</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>Ingress Port = 1 ; IP Src = 10.3.*.* ; IP Dst = 10.2.*.*</p></td>
<td><p>Forward(4)</p></td>
</tr>
<tr class="row-even"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
</div>
<p>Of course, we’ll also need a flow table entry in s3 so that datagrams sent from h5 or h6 are forwarded to s1 over outgoing interface 3:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>s3 Flow Table (Example 1)</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Match</p></th>
<th class="head"><p>Action</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>IP Src = 10.3.*.* ; IP Dst = 10.2.*.*</p></td>
<td><p>Forward(3)</p></td>
</tr>
<tr class="row-even"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
</div>
<p>Lastly, we’ll also need a flow table entry in s2 to complete this first example, so that datagrams arriving from s1 are forwarded to their destination, either host h3 or h4:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>s2 Flow Table (Example 1)</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Match</p></th>
<th class="head"><p>Action</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>Ingress port = 2 ; IP Dst = 10.2.0.3</p></td>
<td><p>Forward(3)</p></td>
</tr>
<tr class="row-even"><td><p>Ingress port = 2 ; IP Dst = 10.2.0.4</p></td>
<td><p>Forward(4)</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="id2">
<h3>第二个示例：负载均衡<a class="headerlink" href="#id2" title="此标题的永久链接">#</a></h3>
<p>A Second Example: Load Balancing</p>
<p>作为第二个示例，我们考虑一个负载均衡场景，其中 h3 发送的目标地址为 10.1.*.* 的数据报应通过 s2 和 s1 之间的直连链路转发，而 h4 发送的相同目标地址的数据报则通过 s2 到 s3，再由 s3 转发至 s1。请注意，这种行为无法通过 IP 的基于目标地址的转发方式实现。在本例中，s2 的流表如下：</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>s2 流表（示例 2）</p></th>
</tr>
<tr class="row-even"><th class="head"><p>匹配条件</p></th>
<th class="head"><p>动作</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>入端口 = 3；IP 目标地址 = 10.1.*.*</p></td>
<td><p>Forward(2)</p></td>
</tr>
<tr class="row-even"><td><p>入端口 = 4；IP 目标地址 = 10.1.*.*</p></td>
<td><p>Forward(1)</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
</div>
<p>s1 中也需要配置流表项，用于将从 s2 接收到的数据报转发至 h1 或 h2；s3 中也需要配置流表项，用于将从 s2 接口 4 接收到的数据报通过接口 3 转发至 s1。请尝试推导 s1 和 s3 中所需的流表项。</p>
<div class="toggle docutils container">
<p>As a second example, let’s consider a load-balancing scenario, where datagrams from h3 destined to 10.1.*.* are to be forwarded over the direct link between s2 and s1, while datagrams from h4 destined to 10.1.*.* are to be forwarded over the link between s2 and s3 (and then from s3 to s1). Note that this behavior couldn’t be achieved with IP’s destination-based forwarding. In this case, the flow table in s2 would be:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>s2 Flow Table (Example 2)</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Match</p></th>
<th class="head"><p>Action</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>Ingress port = 3; IP Dst = 10.1.*.*</p></td>
<td><p>Forward(2)</p></td>
</tr>
<tr class="row-even"><td><p>Ingress port = 4; IP Dst = 10.1.*.*</p></td>
<td><p>Forward(1)</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
</div>
<p>Flow table entries are also needed at s1 to forward the datagrams received from s2 to either h1 or h2; and flow table entries are needed at s3 to forward datagrams received on interface 4 from s2 over interface 3 towards s1. See if you can figure out these flow table entries at s1 and s3.</p>
</div>
</section>
<section id="id3">
<h3>第三个示例：防火墙<a class="headerlink" href="#id3" title="此标题的永久链接">#</a></h3>
<p>A Third Example: Firewalling</p>
<p>作为第三个示例，我们考虑一个防火墙场景，其中 s2 希望仅接收（在其任意接口上）从连接在 s3 上的主机发出的流量。</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>s2 流表（示例 3）</p></th>
</tr>
<tr class="row-even"><th class="head"><p>匹配条件</p></th>
<th class="head"><p>动作</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>IP 源地址 = 10.3.*.*；IP 目标地址 = 10.2.0.3</p></td>
<td><p>Forward(3)</p></td>
</tr>
<tr class="row-even"><td><p>IP 源地址 = 10.3.*.*；IP 目标地址 = 10.2.0.4</p></td>
<td><p>Forward(4)</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
</div>
<p>如果 s2 的流表中没有其他条目，则仅允许来自 10.3.*.* 的流量被转发至连接在 s2 上的主机。</p>
<p>尽管我们这里只考虑了一些基本场景，但通用转发的灵活性和优势已经显而易见。在作业问题中，我们将探索如何利用流表创建多种不同的逻辑行为，包括虚拟网络 —— 两个或多个逻辑上独立的网络（各自具有独立且不同的转发行为），共享同一物理的分组交换机和链路。在 <a class="reference internal" href="../c5/s5.html#c5-5"><span class="std std-ref">第 5.5 节</span></a> 中，我们将再次讨论流表，此时将学习 SDN 控制器如何计算并分发流表，以及交换机与控制器之间所使用的通信协议。</p>
<div class="toggle docutils container">
<p>As a third example, let’s consider a firewall scenario in which s2 wants only to receive (on any of its interfaces) traffic sent from hosts attached to s3.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>s2 Flow Table (Example 3)</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Match</p></th>
<th class="head"><p>Action</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>IP Src = 10.3.*.* IP Dst = 10.2.0.3</p></td>
<td><p>Forward(3)</p></td>
</tr>
<tr class="row-even"><td><p>IP Src = 10.3.*.* IP Dst = 10.2.0.4</p></td>
<td><p>Forward(4)</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
</div>
<p>If there were no other entries in s2’s flow table, then only traffic from 10.3.*.* would be forwarded to the hosts attached to s2.</p>
<p>Although we’ve only considered a few basic scenarios here, the versatility and advantages of generalized forwarding are hopefully apparent. In homework problems, we’ll explore how flow tables can be used to create many different logical behaviors, including virtual networks—two or more logically separate networks (each with their own independent and distinct forwarding behavior)—that use the same physical set of packet switches and links. In <a class="reference internal" href="../c5/s5.html#c5-5"><span class="std std-ref">Section 5.5</span></a>, we’ll return to flow tables when we study the SDN controllers that compute and distribute the flow tables, and the protocol used for communicating between a packet switch and its controller.</p>
</div>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="s3.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">上一页</p>
        <p class="prev-next-title">4.3 Internet 协议（IP）：IPv4、地址、IPv6 等</p>
      </div>
    </a>
    <a class="right-next"
       href="summary.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">下一页</p>
        <p class="prev-next-title">4.5 小结</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> 目录
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#match">4.4.1 Match</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#action">4.4.2 Action</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#openflow-match-plus-action">4.4.3 OpenFlow 中 Match-plus-action 的实际示例</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">第一个示例：简单转发</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">第二个示例：负载均衡</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">第三个示例：防火墙</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
作者： Jim Kurose/Keith Ross
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, Jim Kurose/Keith Ross.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>